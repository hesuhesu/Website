<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WYSIWYG Pdf Creater</title>
    <link rel="stylesheet" href="css/change-color.css">	
    <script src="js/no_click_f5.js"></script>
    <script src="js/html2canvas.js"></script>
    <script src="js/jspdf.min.js"></script>
    <!-- jQuery CDN 추가 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>WYSIWYG Pdf Creater</h1>
    <br>

    <div style = "background-color: aqua; border: 3px solid; text-align: right; float:right">
        <span><strong>&nbsp;&nbsp;현재시간 : </strong></span>
        <span id = "clock"><strong></strong></span><span>&nbsp;&nbsp;</span>
    </div>  

    <br>
    <!-- 에디터를 표시할 div -->
    <!-- 서식 지정 버튼들 -->
    <button onclick="execCommand('bold')">굵게</button>
    <button onclick="execCommand('italic')">기울임</button>
    <button onclick="execCommand('underline')">밑줄</button>
    <button onclick="execCommand('insertUnorderedList')">글머리 기호</button>
    <button onclick="execCommand('insertOrderedList')">번호 매기기</button>
    <button onclick="execCommand('justifyLeft')">왼쪽 정렬</button>
    <button onclick="execCommand('justifyCenter')">가운데 정렬</button>
    <button onclick="execCommand('justifyRight')">오른쪽 정렬</button>
    <button onclick="execCommand('justifyFull')">양쪽 정렬</button>
    <button onclick="execCommand('removeFormat')">서식 제거</button>

    <!-- 에디터 작성 칸 -->
    <div id="pdfDiv" contenteditable="true"></div>

    <br>
    <!-- 이미지 파일을 업로드할 input 요소 -->
    <input type="file" id="imageInput" accept="image/*">
    <br>
    
    <!-- 저장 버튼 -->
    <button type="button" class="btn btn-primary" id="savePdf" >PDF 저장</button>

    <!-- 사용자가 작성한 내용을 저장할 hidden input -->
    <input type="hidden" id="contentInput" name="content">

 
    <script>
        // execCommand를 실행하여 사용자가 선택한 서식을 적용하는 함수
        function execCommand(command) {
            document.execCommand(command, false, null);
        }
        
        // 이미지 파일을 선택했을 때 호출되는 함수
        document.getElementById('imageInput').addEventListener('change', function(event) {
            var file = event.target.files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    var img = document.createElement('img');
                    img.src = e.target.result;
                    document.getElementById('pdfDiv').appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        });

        // 파일 이름에서 확장자를 추출하는 함수
        function getFileExtension(filename) {
            return filename.split('.').pop().toLowerCase();
        }

        // speacial function
        $(document).ready(function() {
            $('#savePdf').click(function() { // pdf저장 button id
                
                html2canvas($('#pdfDiv')[0]).then(function(canvas) { //저장 영역 div id
                
                // 캔버스를 이미지로 변환
                var imgData = canvas.toDataURL('image/png');
                     
                var imgWidth = 190; // 이미지 가로 길이(mm) / A4 기준 210mm
                var pageHeight = imgWidth * 1.414;  // 출력 페이지 세로 길이 계산 A4 기준
                var imgHeight = canvas.height * imgWidth / canvas.width;
                var heightLeft = imgHeight;
                var margin = 10; // 출력 페이지 여백설정
                var doc = new jsPDF('p', 'mm');
                var position = 0;
                   
                // 첫 페이지 출력
                doc.addImage(imgData, 'PNG', margin, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                     
                // 한 페이지 이상일 경우 루프 돌면서 출력
                while (heightLeft >= 20) {
                    position = heightLeft - imgHeight;
                    doc.addPage();
                    doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                // 파일 저장
                doc.save('file-name.pdf');
            });
            });
        })
    </script>
    <script src = "js/clock.js"></script>
    <script src = "js/sugan.js"></script>
</body>
</html>